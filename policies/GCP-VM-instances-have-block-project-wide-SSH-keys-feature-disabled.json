{
  "policyUpi": "PC-GCP-GCE-200",
  "policyId": "72b422c8-bef1-4842-a6c6-7230bf0b3492",
  "policyType": "config",
  "cloudType": "gcp",
  "severity": "low",
  "name": "GCP VM instances have block project-wide SSH keys feature disabled",
  "description": "This policy identifies VM instances which have block project-wide SSH keys feature disabled. Project-wide SSH keys are stored in Compute/Project-metadata. Project-wide SSH keys can be used to login into all the instances within a project. Using project-wide SSH keys eases the SSH key management but if compromised, poses the security risk which can impact all the instances within a project. It is recommended to use Instance specific SSH keys which can limit the attack surface if the SSH keys are compromised.",
  "rule.criteria": "8ae5d48f-8f65-4844-8f32-c83e1d6626ba",
  "searchModel.query": "config from cloud.resource where api.name = 'gcloud-compute-project-info' AND json.rule = commonInstanceMetadata.kind equals \"compute#metadata\" and commonInstanceMetadata.items[?any(key contains \"enable-oslogin\" and (value contains \"Yes\" or value contains \"Y\" or value contains \"True\" or value contains \"true\" or value contains \"TRUE\" or value contains \"1\"))] does not exist and commonInstanceMetadata.items[?any(key contains \"ssh-keys\")] exists as X; config from cloud.resource where api.name = 'gcloud-compute-instances-list' AND json.rule = status equals RUNNING and ( metadata.items[?any(key exists and key contains \"block-project-ssh-keys\" and (value contains \"Yes\" or value contains \"Y\" or value contains \"True\" or value contains \"true\" or value contains \"TRUE\" or value contains \"1\"))] does not exist and metadata.items[?any(key exists and key contains \"enable-oslogin\" and (value contains \"Yes\" or value contains \"Y\" or value contains \"True\" or value contains \"true\" or value contains \"TRUE\" or value contains \"1\"))] does not exist and name does not start with \"gke-\") as Y; filter '$.Y.zone contains $.X.name'; show Y;",
  "recommendation": "1. Login to GCP Portal\n2. Go to Computer Engine (Left Panel)\n3. Go to VM instances\n4. From the list of VMs, choose the reported VM\n5. Click on Edit button\n6. Under SSH Keys section, Check 'Block project-wide SSH keys' on the checkbox\n7. Click on Save",
  "remediable": true,
  "remediation.cliScriptTemplate": "gcloud compute instances add-metadata ${resourceName} --project ${account} --zone ${gcpZoneId} --metadata=block-project-ssh-keys=TRUE",
  "remediation.description": "This CLI command requires 'compute.instances.setMetadata' permission. Successful execution will adds metadata 'block-project-ssh-keys' as TRUE to the GCP compute instance metadata section.\nNote: This CLI command won't be able to remediate instance groups",
  "remediation.impact": "adds metadata 'block-project-ssh-keys' to the GCP compute instance",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "APRA (CPS 234) Information Security",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 1",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 2",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 3",
    "Brazilian Data Protection Law (LGPD)",
    "CCPA 2018",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CIS v1.0.0 (GCP)",
    "CIS v1.1.0 (GCP)",
    "CIS v1.2.0 (GCP)",
    "CIS v1.3.0 (GCP)",
    "CIS v2.0.0 (GCP) Level 1",
    "CIS v3.0.0 (GCP) Level 1",
    "CRI Profile v2.0",
    "CSA CCM v.4.0.1",
    "CSA CCM v4.0.12",
    "Cybersecurity Maturity Model Certification (CMMC) v.1.02",
    "Cybersecurity Maturity Model Certification (CMMC) v.2.0 (Level 2)",
    "Framework for Adoption of Cloud Services by SEBI Regulated Entities (REs)",
    "HIPAA",
    "HITRUST CSF v.11.2.0",
    "HITRUST v.9.4.2 [Deprecated]",
    "ISO 27001:2013",
    "ISO/IEC 27002:2013",
    "ISO/IEC 27017:2015",
    "MITRE ATT&CK v10.0 [Deprecated]",
    "MITRE ATT&CK v12",
    "MITRE ATT&CK v13.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v14.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v15.1 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v6.3 [Deprecated]",
    "MITRE ATT&CK v8.2 [Deprecated]",
    "Microsoft Cloud Security Benchmark v1",
    "NIST CSF",
    "NIST CSF v2.0",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-171 Revision 3",
    "NIST SP 800-172",
    "NYDFS 23 CRR-NY 500.0",
    "New Zealand Information Security Manual (NZISM v3.4)",
    "PCI DSS v3.2.1",
    "PIPEDA",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "Risk Management in Technology (RMiT)",
    "SEBI - Consolidated Cybersecurity and Cyber Resilience Framework (CSCRF)",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2"
  ]
}