{
  "policyUpi": "PC-AZR-STO-1197",
  "policyId": "6c1f731b-beb5-4779-9fc5-f9e436d190c3",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "medium",
  "name": "Azure Storage Account storing Cognitive service diagnostic logs is publicly accessible",
  "description": "Publicly accessible Azure Storage Accounts storing Cognitive service diagnostic logs present a significant security risk. These logs may contain sensitive information, including platform, resource, trace, and metric data, potentially providing attackers with details to carry out malicious activities.\n\nAzure Storage Accounts are used to store Cognitive service diagnostic logs. If improperly configured with public access, attackers can easily retrieve this sensitive log data. This access could enable attackers to understand system architecture, identify vulnerabilities, and subsequently compromise the system.\n\nCompromise of diagnostic logs could lead to data breaches, service disruptions, and significant reputational damage. Restricting access to only authorized services ensures that sensitive data remains protected and limits the potential impact of a breach.\n\nMitigate this risk by configuring your Azure Storage Accounts to only allow access from trusted IP addresses or specific services. Regularly review and update access control lists to maintain a strong security posture and minimize your attack surface.",
  "rule.criteria": "af7266ac-1506-4251-9294-34c8b2f67ab5",
  "searchModel.query": "config from cloud.resource where api.name = 'azure-cognitive-services-account-diagnostic-settings' AND json.rule = (properties.logs[?any(enabled equal ignore case \"true\")] exists or properties.metrics[?any( enabled equal ignore case \"true\" )] exists) and properties.storageAccountId exists as X; config from cloud.resource where api.name = 'azure-storage-account-list' AND json.rule = 'totalPublicContainers > 0 and (properties.allowBlobPublicAccess is true or properties.allowBlobPublicAccess does not exist) and properties.publicNetworkAccess equal ignore case Enabled and networkRuleSet.virtualNetworkRules is empty and (properties.privateEndpointConnections is empty or properties.privateEndpointConnections does not exist)' as Y; filter '$.X.properties.storageAccountId contains $.Y.id'; show Y;",
  "recommendation": "1. Log in to the Azure portal\n2. Navigate to 'Storage Accounts' dashboard\n3. Select the reported storage account\n4. Under 'Data storage' section, Select 'Containers'\n5. Select the blob container you need to modify\n6. Click on 'Change access level'\n7. Set 'Public access level' to 'Private (no anonymous access)'\n8. Click on 'OK'",
  "remediable": true,
  "remediation.cliScriptTemplate": "az resource update --ids ${resourceId} --set properties.allowBlobPublicAccess=false",
  "remediation.description": "This CLI command requires 'Microsoft.Storage/storageAccounts/write' permission. Successful execution disables public access in Azure storage account, this disables anonymous/public read access to a container and the blobs within Azure storage account",
  "remediation.impact": "Disable anonymous/public access to a container and the blobs within Azure storage account",
  "compliance.standard": [
    "CIS Controls v8.1",
    "CSA CCM v4.0.12",
    "HIPAA",
    "HITRUST CSF v.11.2.0",
    "ITSG-33",
    "Insurance Regulatory And Development Authority Of India",
    "Microsoft Cloud Security Benchmark v1",
    "NIST 800-53 Rev 5",
    "NYDFS 23 CRR-NY 500.0",
    "PCI DSS v4.0.1",
    "SOC 2",
    "Secure Controls Framework (SCF) - 2024.2",
    "TX-RAMP Level 1",
    "TX-RAMP Level 2",
    "Trusted Information Security Assessment Exchange (TISAX)"
  ]
}