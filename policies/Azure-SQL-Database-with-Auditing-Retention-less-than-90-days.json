{
  "policyUpi": "PC-AZR-SQL-105",
  "policyId": "fa6fa903-8887-49dd-917f-91687df98dd1",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "informational",
  "name": "Azure SQL Database with Auditing Retention less than 90 days",
  "description": "This policy identifies SQL Databases that have Auditing Retention less than 90 days. Audit Logs can be used to check for anomalies and gives insight into suspected breaches or misuse of information and access. If server auditing is enabled, it always applies to the database. The database will be audited, regardless of the database auditing settings. It is recommended to configure SQL database Audit Retention to be greater than or equal to 90 days and leave the database-level auditing disabled for all databases.",
  "rule.criteria": "7422d8e8-4b0a-4bc5-9769-462b3cd1c6f6",
  "searchModel.query": "config from cloud.resource where api.name = 'azure-sql-server-list' AND json.rule = '(serverBlobAuditingPolicy does not exist or serverBlobAuditingPolicy is empty or serverBlobAuditingPolicy.properties.state equals Disabled or serverBlobAuditingPolicy.properties.retentionDays does not exist or (serverBlobAuditingPolicy.properties.storageEndpoint is not empty and serverBlobAuditingPolicy.properties.state equals Enabled and serverBlobAuditingPolicy.properties.retentionDays does not equal 0 and serverBlobAuditingPolicy.properties.retentionDays less than 90))' as X; config from cloud.resource where api.name = 'azure-sql-db-list' AND json.rule = '(blobAuditPolicy does not exist or blobAuditPolicy is empty or blobAuditPolicy.properties.retentionDays does not exist or (blobAuditPolicy.properties.storageEndpoint is not empty and blobAuditPolicy.properties.state equals Enabled and blobAuditPolicy.properties.retentionDays does not equal 0 and blobAuditPolicy.properties.retentionDays less than 90))' as Y; filter '$.Y.blobAuditPolicy.id contains $.X.sqlServer.name'; show Y;",
  "recommendation": "If server auditing is enabled, it always applies to the database. The database will be audited, regardless of the database auditing settings. It is recommended that you enable only server-level auditing setting and leave the database-level auditing disabled for all databases.\n\nTo configure the Server level audit setting:\n1. Log in to the Azure Portal\n2. Go to SQL servers\n3. Choose the reported each DB server\n4. Select 'Auditing', and verify that 'Enable Azure SQL Auditing' is set\n5. If Storage is selected, expand 'Advanced properties'\n6. Set the Retention (days) setting is greater than 90 days or 0 for unlimited retention.\nNote: The default value for the retention period is 0 (unlimited retention).\n7. Click on 'Save'\n\nIt is recommended to avoid enabling both server auditing and database blob auditing together, unless; If you want to use a different storage account, retention period or Log Analytics Workspace for a specific database or want to use for audit event types or categories for a specific database that differ from the rest of the databases on the server.\nTo configure the Database level audit setting:\n1. Log in to the Azure Portal\n2. Go to SQL databases\n3. Choose the reported each DB\n4. Select 'Auditing', and verify that 'Enable Azure SQL Auditing' is set\n5. If Storage is selected, expand 'Advanced properties'\n6. Set the Retention (days) setting is greater than 90 days or 0 for unlimited retention.\nNote: The default value for the retention period is 0 (unlimited retention).\n7. Click on 'Save'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "APRA (CPS 234) Information Security",
    "Brazilian Data Protection Law (LGPD)",
    "CCPA 2018",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CRI Profile v1.2.1",
    "CSA CCM v.4.0.6",
    "CSA CCM v3.0.1",
    "CSA CCM v4.0.12",
    "CyberSecurity Law of the People's Republic of China",
    "Cybersecurity Maturity Model Certification (CMMC) v.1.02",
    "DORA",
    "Fedramp (Low)",
    "Fedramp (Moderate)",
    "HITRUST CSF v.11.2.0",
    "HITRUST CSF v9.3 [Deprecated]",
    "ISO 27001:2013",
    "ISO 27002:2022",
    "ISO/IEC 27001:2022",
    "ITSG-33",
    "Insurance Regulatory And Development Authority Of India",
    "MLPS 2.0 (Level 2)",
    "Microsoft Cloud Security Benchmark v1",
    "NIST 800-53 Rev 5",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-171 Revision 3",
    "NIST SP 800-172",
    "New Zealand Information Security Manual (NZISM v3.4)",
    "PCI DSS v3.2.1",
    "PCI DSS v4.0",
    "PIPEDA",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "SOC 2",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2",
    "TX-RAMP Level 2"
  ]
}