{
  "policyUpi": "PC-GCP-GVA-1291",
  "policyId": "09f02f06-c66c-48c4-b8fa-85e1d05cc321",
  "policyType": "config",
  "cloudType": "gcp",
  "severity": "medium",
  "name": "GCP Vertex AI Workbench Instance is using default service account with the editor role",
  "description": "This policy identifies GCP Vertex AI Workbench Instances that are using the default service account with the Editor role.\n\nThe Compute Engine default service account is automatically created with an autogenerated name and email address when you enable the Compute Engine API. By default, this service account is granted the IAM basic Editor role unless you explicitly disable this behavior. If this service account is assigned to a Vertex AI Workbench instance, it may lead to potential privilege escalation.\n\nIn line with the principle of least privilege, it is recommended that Vertex AI Workbench Instances are not assigned the 'Compute Engine default service account', particularly when the Editor role is granted to the service account.",
  "rule.criteria": "9fe0cc32-90af-44a2-ba94-3eea93380af1",
  "searchModel.query": "config from cloud.resource where api.name = 'gcloud-vertex-ai-workbench-instance' AND json.rule = state equals \"ACTIVE\" and gceSetup.serviceAccounts[*].email contains \"compute@developer.gserviceaccount.com\" as X; config from cloud.resource where api.name = 'gcloud-projects-get-iam-user' AND json.rule = user contains \"compute@developer.gserviceaccount.com\" and roles[*] contains \"roles/editor\" as Y; filter ' $.X.gceSetup.serviceAccounts[*].email equals $.Y.user'; show X;",
  "recommendation": "1. Login to the GCP console\n2. Navigate to the 'Vertex AI' service\n3. In side panel, under 'Notebooks', go to 'Workbench'\n4. Under 'INSTANCES' tab, select 'VIEW' as 'INSTANCES'\n5. Click on the alerting instance\n6. Under the 'SYSTEM' tab, in front of 'VM details', click on the 'View in Compute Engine' link\n7. Stop the VM by clicking on the 'STOP' button. Click the 'STOP' button on the confirmation dialogue.\n8. Once the the VM has been stopped, click on the 'EDIT' button\n9. Under 'Identity and API access', use the dropdown to select a non-default service account as per needs\n10. Click on 'Save'\n11. Click on 'START/RESUME' from the top menu",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "NIST 800-53 Rev 5"
  ]
}