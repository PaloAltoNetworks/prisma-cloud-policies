{
  "policyUpi": "PC-AWS-EC2-698",
  "policyId": "32f75d19-c34d-4ec5-aa8c-675959db3aad",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "high",
  "name": "AWS EC2 instance not configured with Instance Metadata Service v2 (IMDSv2)",
  "description": "AWS EC2 instances lacking Instance Metadata Service v2 (IMDSv2) are susceptible to unauthorized access of sensitive metadata. Using IMDSv1 exposes instances to various attacks through easily exploitable misconfigurations.\n\nThe Instance Metadata Service provides metadata about the EC2 instance, including security credentials. IMDSv1 uses a simple HTTP request, making it vulnerable to attacks such as session hijacking and credential theft. Failure to use IMDSv2 exposes the instance to compromise via techniques like SSRF, potentially leading to further lateral movement within the environment.\n\nCompromise of instance metadata can result in unauthorized access to the instance and sensitive data it holds, leading to data breaches, service disruptions, and potential financial losses. IMDSv2 mitigates these risks with its session-based authentication mechanism.\n\nEnable IMDSv2 for all EC2 instances. Restrict access to instance metadata by using strong authentication mechanisms and regularly review and update instance configurations. Consider implementing additional security controls such as network segmentation and intrusion detection systems to further enhance security posture.",
  "rule.criteria": "81c165ce-f66e-441a-8ea0-56a107175ccc",
  "searchModel.query": "config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-instances' AND json.rule = state contains running and metadataOptions.httpEndpoint equals enabled and metadataOptions.httpTokens does not contain required",
  "recommendation": "1. Log in to the AWS Console\n2. In the console, select the specific region from the region drop-down on the top right corner, for which the alert is generated.\n3. Refer 'Configure instance metadata options for existing instances' section from follwoing URL\nhttps://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html\n\nNOTE: Make a precaution before you enforce the use of IMDSv2, as applications or agents that use IMDSv1 for instance metadata access will break.",
  "remediable": true,
  "remediation.cliScriptTemplate": "aws ec2 modify-instance-metadata-options --instance-id ${resourceId} --region ${region} --http-tokens required --http-endpoint enabled",
  "remediation.description": "This CLI command requires 'ec2:ModifyInstanceMetadataOptions' permission. Successful execution will enable Instance Metadata Service v2 (IMDSv2) on your EC2 Instance.",
  "remediation.impact": "Enables Metadata Service v2 (IMDSv2)",
  "compliance.standard": [
    "AWS Foundational Security Best Practices standard",
    "Australian Cyber Security Centre (ACSC) Essential Eight",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 1",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 2",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 3",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CIS v2.0.0 (AWS) - Level 1",
    "CIS v3.0.0 (AWS) Level 1",
    "CIS v4.0.0 (AWS) Level 1",
    "Cybersecurity Maturity Model Certification (CMMC) v.2.0 (Level 1)",
    "HITRUST CSF v.11.2.0",
    "HITRUST CSF v.9.6.0",
    "ISO 27002:2022",
    "ISO/IEC 27001:2022",
    "Insurance Regulatory And Development Authority Of India",
    "MAS TRM 2021",
    "MITRE ATT&CK v10.0 [Deprecated]",
    "MITRE ATT&CK v12",
    "MITRE ATT&CK v13.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v14.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v15.1 Cloud IaaS for Enterprise",
    "MLPS 2.0 (Level 2)",
    "Microsoft Cloud Security Benchmark v1",
    "NYDFS 23 CRR-NY 500.0",
    "New Zealand Information Security Manual (NZISM v3.4)",
    "PCI DSS v4.0",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2",
    "Trusted Information Security Assessment Exchange (TISAX)"
  ]
}