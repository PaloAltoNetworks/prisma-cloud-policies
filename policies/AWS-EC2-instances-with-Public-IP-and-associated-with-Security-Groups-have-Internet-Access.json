{
  "policyUpi": "PC-AWS-EC2-354",
  "policyId": "ba9eeea6-782c-45aa-a953-f639582412c7",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "medium",
  "name": "AWS EC2 instances with Public IP and associated with Security Groups have Internet Access",
  "description": "This policy identifies AWS EC2 instances with Public IP and associated with Security Groups have Internet Access. EC2 instance receives a public IP address when launched in a default VPC security group (A security group acts as a virtual firewall for your instance to control inbound and outbound traffic.) and we don't assign a public IP address to instances launched in a non-default subnet. Therefore it's a best practice to ensure that there are no EC2 instances with Public IP that are associated with Security Groups which have Internet Access.",
  "rule.criteria": "76f2927e-08b7-4765-9f18-77655acad647",
  "searchModel.query": "config from cloud.resource where api.name = 'aws-ec2-describe-instances' AND json.rule = state.name equals running and publicIpAddress exists and publicIpAddress is not empty as X; config from cloud.resource where api.name = 'aws-ec2-describe-security-groups' AND json.rule = ipPermissions[?any(ipRanges[*] contains 0.0.0.0/0 or ipv6Ranges[*].cidrIpv6 contains ::/0)] exists as Y; filter '$.X.securityGroups[*].groupName equals $.Y.groupName'; show X;",
  "recommendation": "It is recommended to avoid using Public IP address and associate your EC2 instance with Elastic IP instead.\n\nA. To allocate an Elastic IP address for use in EC2-Classic/EC2-VPC using the console\n1. Sign into the AWS console\n2. Go to EC2 console\n3. In the navigation pane, choose Elastic IPs\n4. Click 'Allocate new address'\n5. Click Associate\n\nB. To associate an Elastic IP address with an instance using the console.\n\n1. Sign into the AWS console\n2. Go to EC2 console\n3. In the navigation pane, choose Elastic IPs\n4. Select an Elastic IP address and choose Actions, Associate address\n5. Select the instance from Instance and then choose Associate.\n6. Click Associate\n\nC. To restrict Security Groups allowing all traffic, follow the instructions below:\n\n1. Log in to the AWS console and navigate to the 'VPC' service\n2. Click on the 'Security Group' specific to the alert\n3. Click on 'Inbound Rules' and remove the row with the IP value as 0.0.0.0/0 or ::/0",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "APRA (CPS 234) Information Security",
    "Brazilian Data Protection Law (LGPD)",
    "CCPA 2018",
    "Cybersecurity Maturity Model Certification (CMMC) v.1.02",
    "HITRUST v.9.4.2",
    "MITRE ATT&CK v6.3",
    "MITRE ATT&CK v8.2",
    "Multi-Level Protection Scheme (MLPS) v2.0",
    "NIST 800-53 Rev 5",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-172",
    "PCI DSS v3.2.1",
    "PIPEDA"
  ]
}