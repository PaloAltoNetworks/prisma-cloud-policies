{
  "policyUpi": "PC-AZR-STO-405",
  "policyId": "3d8d4e24-1336-4bc1-a1f3-15e680edca07",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "low",
  "name": "Azure Storage Account 'Trusted Microsoft Services' access not enabled",
  "description": "This policy identifies Storage Accounts which have 'Trusted Microsoft Services' access not enabled. Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules. These services will then use strong authentication to access the storage account. If the Allow trusted Microsoft services exception is enabled, the following services: Azure Backup, Azure Site Recovery, Azure DevTest Labs, Azure Event Grid, Azure Event Hubs, Azure Networking, Azure Monitor and Azure SQL Data Warehouse (when registered in the subscription), are granted access to the storage account. It is recommended to enable Trusted Microsoft Services on storage account instead of leveraging network rules.",
  "rule.criteria": "04aaadfc-65e0-4347-9a3e-1922e9a2068e",
  "searchModel.query": "config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-storage-account-list' AND json.rule = 'networkRuleSet.bypass does not contain AzureServices'",
  "recommendation": "1. Log in to Azure Portal\n2. Navigate to Storage Accounts dashboard\n3. Select the storage account you need to modify\n4. Under 'Security + networking' section, Click on 'Networking'\n5. Under 'Firewalls and virtual networks' tab, Ensure that 'Enabled from selected virtual networks and IP addresses' is selected.\n6. Under 'Exceptions', Make sure that 'Allow Azure services on the trusted services list to access this storage account' is checked.\n7. Click on 'Save'",
  "remediable": true,
  "remediation.cliScriptTemplate": "az storage account update --name ${resourceName} --resource-group  ${resourceGroup} --bypass AzureServices",
  "remediation.description": "This CLI command requires 'Microsoft.Storage/storageAccounts/*' permission. Successful execution will enable Azure accounts to bypass 'Trusted Microsoft Services'.",
  "remediation.impact": "allow the set of trusted Microsoft services to bypass the network rules",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "APRA (CPS 234) Information Security",
    "Azure Security Benchmark (v2)",
    "Azure Security Benchmark (v3)",
    "Brazilian Data Protection Law (LGPD)",
    "CCPA 2018",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CIS v1.1 (Azure)",
    "CIS v1.2.0 (Azure)",
    "CIS v1.3.0 (Azure)",
    "CIS v1.3.1 (Azure)",
    "CIS v1.4.0 (Azure)",
    "CIS v2.0.0 (Azure) Level 2",
    "CIS v2.1.0 (Azure) Level 2",
    "CSA CCM v.4.0.1",
    "CSA CCM v4.0.12",
    "CyberSecurity Law of the People's Republic of China",
    "Cybersecurity Maturity Model Certification (CMMC) v.1.02",
    "HITRUST CSF v.11.2.0",
    "HITRUST v.9.4.2 [Deprecated]",
    "ISO/IEC 27002:2013",
    "ISO/IEC 27017:2015",
    "ISO/IEC 27018:2019",
    "ITSG-33",
    "MITRE ATT&CK v10.0 [Deprecated]",
    "MITRE ATT&CK v12",
    "MITRE ATT&CK v13.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v14.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v6.3 [Deprecated]",
    "MITRE ATT&CK v8.2 [Deprecated]",
    "MLPS 2.0 (Level 2)",
    "Microsoft Cloud Security Benchmark v1",
    "NIST 800-53 Rev 5",
    "NIST CSF",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-171 Revision 3",
    "NIST SP 800-172",
    "PCI DSS v3.2.1",
    "PIPEDA",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "SOC 2",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2",
    "TX-RAMP Level 1",
    "TX-RAMP Level 2"
  ]
}