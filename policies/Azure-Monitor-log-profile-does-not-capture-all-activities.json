{
  "policyUpi": "PC-AZR-MON-524",
  "policyId": "64f0ec41-cdcb-42e4-b556-eb66946a62ff",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "informational",
  "name": "Azure Monitor log profile does not capture all activities",
  "description": "This policy identifies the Monitor log profiles which are not configured to capture all activities. A log profile controls how the activity log is exported. Configuring the log profile to collect logs for the categories 'Write', 'Delete' and 'Action' ensures that all the control/management plane activities performed on the subscription are exported.",
  "rule.criteria": "03a90ea7-d8f5-4761-beb7-ffcc24237741",
  "searchModel.query": "config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-monitor-log-profiles-list' AND json.rule = 'isLegacy is true and (properties.categories[*] does not contain Write or properties.categories[*] does not contain Delete or properties.categories[*] does not contain Action)'",
  "recommendation": "On the Azure Portal, there is no provision to check or set categories. However, when a log profile is created using the Azure Portal, Write, Delete and Action categories are set by default.\n\nLog profile activities can be set only through CLI using REST API and CLI is:\n1. To list the Log profile run,\naz monitor log-profiles list\n\n2. Note the name of reported log profile and replace it with <LOG_PROFILE_NAME> in below command:\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/providers/microsoft.insights/logprofiles/<LOG_PROFILE_NAME>?api-version=2016-03-01' | jq\nCopy the JSON output and save it as 'input.json' file.\n\n3. Edit the saved 'input.json' file to add all activities 'Write', 'Delete' and 'Action' in categories JSON array section.\n\n4. Run below command taking 'input.json' as input file,\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/providers/microsoft.insights/logprofiles/<LOG_PROFILE_NAME>?api-version=2016-03-01 -d@\"input.json\"'\n\nNOTE: To run all above CLIs you have to be configured with Azure subscription and accessToken locally. And these CLI commands require 'microsoft.insights/logprofiles/*' permission.",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "APRA (CPS 234) Information Security",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CIS v1.1 (Azure)",
    "CRI Profile v1.2.1",
    "CRI Profile v2.0",
    "CSA CCM v.4.0.1",
    "CSA CCM v.4.0.6",
    "CyberSecurity Law of the People's Republic of China",
    "DORA",
    "FFIEC",
    "Fedramp (Low)",
    "Fedramp (Moderate)",
    "GDPR",
    "HIPAA",
    "HITRUST v.9.4.2 [Deprecated]",
    "ISO 27002:2022",
    "ISO/IEC 27001:2022",
    "ISO/IEC 27002:2013",
    "ISO/IEC 27017:2015",
    "MITRE ATT&CK v10.0 [Deprecated]",
    "MITRE ATT&CK v12",
    "MITRE ATT&CK v13.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v14.0 Cloud IaaS for Enterprise",
    "MLPS 2.0 (Level 2)",
    "NIST 800-53 Rev 5",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "NIST CSF v2.0",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-171 Revision 3",
    "NIST SP 800-172",
    "PCI DSS v3.2.1",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "SEBI - Consolidated Cybersecurity and Cyber Resilience Framework (CSCRF)",
    "SOC 2",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2",
    "Telecommunications Security Act - TSA"
  ]
}