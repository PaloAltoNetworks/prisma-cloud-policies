{
  "policyUpi": "PC-AWS-DOC-1160",
  "policyId": "64308452-3d8f-4a1c-b566-a49f9a7c221b",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "informational",
  "name": "AWS DocumentDB cluster does not publish audit logs to CloudWatch Logs",
  "description": "This policy identifies the Amazon DocumentDB cluster where audit logging is disabled or audit logs are not published to Amazon CloudWatch Logs.\n\nDocumentDB integrates with Amazon CloudWatch for performance metric gathering and analysis, supporting CloudWatch Alarms. While DocumentDB provides customizable audit logs for monitoring database operations, these logs are not automatically sent to CloudWatch Logs, limiting centralized monitoring and analysis of database activities.\n\nIt is recommended to configure the DocumentDB cluster to enable audit logs and publish audit logs to CloudWatch logs.",
  "rule.criteria": "308c65cf-bc43-4e9c-8867-d9e39d3d221c",
  "searchModel.query": "config from cloud.resource where api.name = 'aws-docdb-db-cluster' AND json.rule = Status equals \"available\" as X; config from cloud.resource where api.name = 'aws-docdb-db-cluster-parameter-group' AND json.rule = parameters.audit_logs.ParameterValue is member of ( 'disabled','none') as Y; filter '($.X.EnabledCloudwatchLogsExports.member does not contain \"audit\") or $.X.DBClusterParameterGroup equals $.Y.DBClusterParameterGroupName' ; show X;",
  "recommendation": "To create a custom parameter group if the cluster has only the default parameter group use the following steps: \n\n1. Sign in to the AWS Management Console and open the Amazon DocumentDB console. \n2. In the navigation pane, choose 'Parameter groups'. \n3. Choose 'Create'. The 'Create cluster parameter group' window appears. \n4. In the 'New cluster parameter group name', enter the name of the new DB cluster parameter group. \n5. In the 'Family' list, select a 'DB parameter group family'. \n6. In the Description box, enter a description for the new DB cluster parameter group. \n7. Click 'Create'. \n\nTo modify the custom DB cluster parameter group to enable query logging, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon DocumentDB console. \n2. In the navigation pane, choose 'Parameter groups'. \n3. In the list, choose the above-created parameter group or the reported resource custom parameter group that you want to modify. \n4. Click on the 'audit_logs' parameter and click 'Edit'. \n5. Change the value of the 'audit_logs' parameter to any value (ddl,dml_read,dml_write, all) other than 'disabled' or 'none' you want to modify according to your requirements. \n6. Choose 'Apply immediately' to apply the changes immediately or 'Apply during the next scheduled maintenance window' according to your requirements. \n7. Choose 'Modify cluster parameter' to modify the values. \n\nTo modify an AWS DocumentDB cluster to use the custom parameter group, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon DocumentDB console. \n2. In the navigation pane, choose 'Databases', and then choose the 'DB instance' that you want to modify. \n3. Choose the reported cluster that you want to associate your parameter group with. Choose 'Actions', and then choose 'Modify' to modify your cluster. \n4. Scroll down to 'Cluster options', select the above-created cluster parameter group from the DB parameter group dropdown. \n5. Choose 'Continue' and check the summary of modifications. \n6. Choose 'Apply immediately' to apply the changes immediately or 'Apply during the next scheduled maintenance window' according to your requirements. \n7. On the confirmation page, review your changes. If they are correct, choose 'Modify cluster' to save your changes. \n\nWhen the value of the audit_logs cluster parameter is enabled, ddl, dml_read, or dml_write, you must also enable Amazon DocumentDB to export logs to Amazon CloudWatch. If you omit either of these steps, audit logs will not be sent to CloudWatch. \n\nTo modify an Amazon DocumentDB cluster for enabling export logs to cloudwatch, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon DocumentDB console. \n2. In the navigation pane, choose 'Databases', and then choose the 'DB instance' that you want to modify. \n3. Choose the reported cluster that you want to associate your parameter group with. Choose 'Actions', and then choose 'Modify' to modify your cluster.\n4. Scroll down to the Log exports section, and choose 'Enable' for the 'Audit logs'.\n5. Choose 'Continue'.\n6. Choose 'Apply immediately' to apply the changes immediately or 'Apply during the next scheduled maintenance window' according to your requirements.\n7. Choose 'Modify cluster'.",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "CIS Controls v8.1",
    "CSA CCM v4.0.12",
    "DORA",
    "GDPR",
    "HITRUST CSF v.11.2.0",
    "ISO/IEC 27001:2022",
    "ITSG-33",
    "Microsoft Cloud Security Benchmark v1",
    "SOC 2",
    "Secure Controls Framework (SCF) - 2024.2",
    "TX-RAMP Level 1",
    "TX-RAMP Level 2"
  ]
}