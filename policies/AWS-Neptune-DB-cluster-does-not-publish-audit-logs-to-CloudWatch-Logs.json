{
  "policyUpi": "PC-AWS-NEP-1161",
  "policyId": "b37b487d-894a-4035-9533-3cfa7e4f62b1",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "informational",
  "name": "AWS Neptune DB cluster does not publish audit logs to CloudWatch Logs",
  "description": "This policy identifies Amazon Neptune DB clusters where audit logging is disabled or audit logs are not published to Amazon CloudWatch Logs.\n\nNeptune DB integrates with Amazon CloudWatch for performance metric gathering and analysis, supporting CloudWatch Alarms. While Neptune DB provides customizable audit logs for monitoring database operations, these logs are not automatically sent to CloudWatch Logs, limiting centralized monitoring and analysis of database activities.\n\nIt is recommended to configure the Neptune DB cluster to enable audit logs and publish audit logs to CloudWatch logs.",
  "rule.criteria": "51c61370-db91-4773-9817-42ac176f6096",
  "searchModel.query": "config from cloud.resource where api.name = 'aws-neptune-db-cluster' AND json.rule = Status equals \"available\" as X; config from cloud.resource where api.name = 'aws-neptune-db-cluster-parameter-group' AND json.rule = parameters.neptune_enable_audit_log.ParameterValue exists and parameters.neptune_enable_audit_log.ParameterValue equals 0 as Y; filter '($.X.EnabledCloudwatchLogsExports.member does not contain \"audit\") or $.X.DBClusterParameterGroup equals $.Y.DBClusterParameterGroupName' ; show X;",
  "recommendation": "To create a custom parameter group if the cluster has only the default parameter group use the following steps: \n\n1. Sign in to the AWS Management Console and open the Amazon Neptune DB console. \n2. In the navigation pane, choose 'Parameter groups'. \n3. Choose 'Create'. The 'Create cluster parameter group' window appears. \n4. In the 'Parameter group family' list, select a 'DB parameter group family'.\n5. In the 'Parameter group type', Select 'DB cluster parameter group'.\n6. In the 'New cluster parameter group name', enter the name of the new DB cluster parameter group. \n7. In the Description box, enter a description for the new DB cluster parameter group. \n8. Click 'Create'. \n\nTo modify the custom DB cluster parameter group to enable query logging, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon Neptune DB console. \n2. In the navigation pane, choose 'Parameter groups'. \n3. In the list, choose the above-created parameter group or the reported resource custom parameter group that you want to modify. \n4. Change the value of the 'neptune_enable_audit_log' parameter to '1' in the value drop-down and click on tick mark for enabling audit logs.\n\nTo modify an Amazon Neptune DB Cluster to use the custom parameter group, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon Neptune DB console. \n2. In the navigation pane, choose 'Databases', and then choose the 'DB instance' that you want to modify. \n3. Choose the reported cluster that you want to associate your parameter group with. Choose 'Actions', and then choose 'Modify' to modify your cluster. \n4. Under 'Additional settings', select the above-created cluster parameter group from the DB parameter group dropdown. \n5. Choose 'Continue' and check the summary of modifications. \n6. On the confirmation page, review your changes. If they are correct, choose 'Modify cluster' to save your changes. \n\nTo modify an Amazon Neptune DB cluster for enabling export logs to cloudwatch, follow the below steps: \n\n1. Sign in to the AWS Management Console and open the Amazon Neptune DB console. \n2. In the navigation pane, choose 'Databases', and then choose the 'DB instance' that you want to modify. \n3. Choose the reported cluster that you want to associate your parameter group with. Choose 'Actions', and then choose 'Modify' to modify your cluster.\n4. Scroll down to the Log exports section, and choose 'Enable' for the 'Audit logs'.\n5. Choose 'Continue'.\n6. Choose 'Modify cluster'.",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": ""
}