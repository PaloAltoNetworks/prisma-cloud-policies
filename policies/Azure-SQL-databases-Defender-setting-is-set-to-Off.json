{
  "policyUpi": "PC-AZR-SQL-101",
  "policyId": "8f7eee48-dffb-4f18-9207-8ea48680b0e2",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "medium",
  "name": "Azure SQL databases Defender setting is set to Off",
  "description": "This policy identifies Azure SQL databases which have Defender setting set to Off. Azure Defender for SQL provides a new layer of security, which enables customers to detect and respond to potential threats as they occur by providing security alerts on anomalous activities. Users will receive an alert upon suspicious database activities, potential vulnerabilities, SQL injection attacks, as well as anomalous database access patterns. Advanced threat protection alerts provide details of suspicious activity and recommend action on how to investigate and mitigate the threat.",
  "rule.criteria": "719834bf-d296-4adf-973a-9c74b4bb24c6",
  "searchModel.query": "config from cloud.resource where api.name = 'azure-sql-db-list' AND json.rule = sqlDatabase.properties.status equals Online and (securityAlertPolicy.properties.state equals Disabled or securityAlertPolicy does not exist or securityAlertPolicy.[*] isEmpty) as X; config from cloud.resource where api.name = 'azure-sql-server-list' AND json.rule = ['sqlServer'].['properties.state'] equals Ready and (serverSecurityAlertPolicy.properties.state equals Disabled or serverSecurityAlertPolicy does not exist or serverSecurityAlertPolicy isEmpty) as Y; filter \"$.X.blobAuditPolicy.id contains $.Y.sqlServer.name\"; show X;",
  "recommendation": "If Azure Defender is enabled at server level it will also be applied to all the database, regardless of the database Azure Defender settings. It is recommended that you enable only server-level Azure Defender settings.\nTo enable auditing at server level:\n1. Log in to the Azure Portal\n2. Note down the reported SQL database and SQL server\n3. Select 'SQL servers', Click on the SQL server instance you wanted to modify\n4. Click on 'Microsoft Defender for Cloud' under 'Security'\n5. Click on 'Enable Microsoft Defender for SQL'\n\nIt is recommended to avoid enabling Azure Defender in both server and database.\nIf you want to enable different storage account, email addresses for scan and alert notifications or 'Advanced Threat Protection types' for a specific database that differ from the rest of the databases on the server. Then to enable auditing at database level by:\n1. Log in to the Azure Portal\n2. Note down the reported SQL database\n3. Select 'SQL databases', Click on the SQL database instance you wanted to modify\n4. Click on 'Microsoft Defender for Cloud' under 'Security'\n5. Click on 'Enable Microsoft Defender for SQL'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "ACSC Information Security Manual (ISM) (Latest)",
    "APRA (CPS 234) Information Security",
    "Australian Energy Sector Cyber Security Framework (AESCSF)",
    "Brazilian Data Protection Law (LGPD)",
    "CCPA 2018",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CSA CCM v.4.0.1",
    "Cloud Security Assurance Program (CSAP) - IaaS",
    "Cloud Security Assurance Program (CSAP) - SaaS Simplified",
    "CyberSecurity Law of the People's Republic of China",
    "Cybersecurity Maturity Model Certification (CMMC) v.1.02",
    "Cybersecurity Maturity Model Certification (CMMC) v.2.0 (Level 2)",
    "Fedramp (Moderate)",
    "ISO 27001:2013",
    "ISO/IEC 27002:2013",
    "ISO/IEC 27017:2015",
    "ISO/IEC 27018:2019",
    "Insurance Regulatory And Development Authority Of India",
    "MLPS 2.0 (Level 2)",
    "Microsoft Cloud Security Benchmark v1",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "NIST SP 800-171 Revision 2",
    "NIST SP 800-171 Revision 3",
    "NIST SP 800-172",
    "New Zealand Information Security Manual (NZISM v3.4)",
    "PCI DSS v3.2.1",
    "PIPEDA",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "SEBI - Consolidated Cybersecurity and Cyber Resilience Framework (CSCRF)",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "Secure Controls Framework (SCF) - 2024.2",
    "Trusted Information Security Assessment Exchange (TISAX)"
  ]
}