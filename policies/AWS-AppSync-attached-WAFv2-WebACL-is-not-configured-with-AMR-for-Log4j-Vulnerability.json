{
  "policyUpi": "PC-AWS-ASY-835",
  "policyId": "efecd50f-5a1f-4d6d-b862-8e760b9612e4",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "medium",
  "name": "AWS AppSync attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability",
  "description": "This policy identifies AppSync attached with WAFv2 WebACL which is not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, AppSync attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).\n\nFor more information please refer below URL,\nhttps://aws.amazon.com/security/security-bulletins/AWS-2021-006/",
  "rule.criteria": "ad83c867-f484-4692-930d-9db4b3e2738e",
  "searchModel.query": "config from cloud.resource where api.name = 'aws-appsync-graphql-api' AND json.rule = wafWebAclArn is not empty as X; config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.webACL.arn equals $.X.wafWebAclArn'; show X;",
  "recommendation": "1. Sign in to the AWS console\n2. Go to the AppSync console\n3. Click on the reported AppSync\n4. Choose 'Settings' in the navigation pane\n5. In the Web application firewall section, note down the associated AWS WAF web ACL\n6. Go to the noted WAF web ACL in AWS WAF & Shield Service\n7. Under 'Rules' tab click on 'Add rules' and select 'Add managed rule groups'\n8. Under 'AWS managed rule groups' enable 'Anonymous IP list' and 'Known bad inputs'\n9. Click on 'Add rules'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "CIS Controls v7.1",
    "CIS Controls v8",
    "Cybersecurity Maturity Model Certification (CMMC) v.2.0 (Level 1)",
    "FFIEC",
    "PCI DSS v4.0"
  ]
}